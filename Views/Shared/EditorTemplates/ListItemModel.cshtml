@model WebApplication1.Models.ListItemModel

@Html.DropDownListFor(model => model.Value, Model.ListItems, new { @class = "form-control listItemModel" })

@Html.TextBox("newOption","", new { @class = "form-control listItemModelTextbox hide" })

<button type="button" class="btn btn-default" aria-label="Left Align" onclick="addListOption($(this))">
    <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
</button>

<button type="button" class="btn btn-default hide" aria-label="Left Align" onclick="saveListOption($(this), '@Model.List')">
    <span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>
</button>

<div class="hide"><span class="text-danger field-validation-error">Save Failed</span></div>

<script>
    function addListOption(btn) {
        btn.addClass('hide');
        btn.next().removeClass('hide');

        btn.prev().removeClass('hide');
        btn.prev().focus();
        btn.prev().prev().addClass('hide');
    }

    function saveListOption(btn, listName) {

        var txt = btn.prev().prev();
        var newValue = txt.val();

        if (newValue){
            $.ajax({
                type: "POST",
                url: "/List/AddListOption",
                data: { value: newValue, list: listName },
                success: function(data){
                    btn.prev().prev().prev().prev().append($("<option></option>").text(data)); 

                    btn.addClass('hide');
                    btn.prev().removeClass('hide');

                    txt.addClass('hide');
                    btn.prev().prev().prev().removeClass('hide');
                },
                error: function(XMLHttpRequest, textStatus, errorThrown) {
                    btn.next().removeClass('hide');
                }
            });
        }
        else{
            btn.addClass('hide');
            btn.prev().removeClass('hide');

            txt.addClass('hide');
            btn.prev().prev().prev().removeClass('hide');

            btn.next().addClass('hide');
        }
    }
</script>

